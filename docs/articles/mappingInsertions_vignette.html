<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to map species insertions in phylogenetic tree? â€¢ FishPhyloMaker</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to map species insertions in phylogenetic tree?">
<meta property="og:description" content="FishPhyloMaker">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FishPhyloMaker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/FishPhyloMaker_vignette.html">Using FishPhyloMaker to build phylogenies for bony fishes</a>
    </li>
    <li>
      <a href="../articles/mappingInsertions_vignette.html">How to map species insertions in phylogenetic tree?</a>
    </li>
    <li>
      <a href="../articles/whichFishAdd_vignette.html">How to know which species must be added to phylogeny?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mappingInsertions_vignette_files/header-attrs-2.3/header-attrs.js"></script><script src="mappingInsertions_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to map species insertions in phylogenetic tree?</h1>
            
      
      
      <div class="hidden name"><code>mappingInsertions_vignette.Rmd</code></div>

    </div>

    
    
<p>In this article we will show how we can map the insertions made in phylogenetic tree through the procedure realized in <code>FishPhyloMaker</code> function. Mapping the insertions is of special importance since allow to understand how the gaps in phylogenetic knowledge is distributed in the [megatree]. For example, we can understand if the Characidae family present more phylogenetic gaps than Loricariidae family.</p>
<p>This can be done by using the information contained in the output of <code>FishPhyloMaker</code> function when we set the argument <code>return.insertions = TRUE</code>. This returns a data frame containing the categories of insertion for each species, these categories are:</p>
<ul>
<li>
<strong>Present_in_tree</strong> the species was already present in the original tree;</li>
<li>
<strong>Congeneric_insertion</strong> species inserted as a sister species of the same genus presented in the tree;</li>
<li>
<strong>Congeneric_insertion_roundFamily</strong> species inserted as a sister species of the same genus presented in the tree, but that were added after a species of local pool of the same genus be inserted in the tree;</li>
<li>
<strong>Family_insertion</strong> if not found any congeneric species, the species will be inserted near to, or between genus of the same family presented in the tree. The user can also insert the species in the base of the family;</li>
<li>
<strong>Order_insertion</strong> if not found any genus of the same family of the species that must be inserted, the species will be inserted near to a given family, between two families or at the node that corresponds to the Order of this species;</li>
<li>
<strong>Not_inserted</strong> if species was not inserted in any of the previous steps, it will not be inserted in the final tree;</li>
</ul>
<p>To obtain this data frame we need first to run <code>FishPhyloMaker</code> setting the argument <code>return.insertions = TRUE</code>. We will use data of fish occurrence in the Neotropical region present in <code>{FishPhyloMaker}</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FishPhyloMaker</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fish_SAmerica"</span><span class="op">)</span></code></pre></div>
<p>We need to format this data using function <code>FishTaxaMaker</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">taxon_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FishTaxaMaker.html">FishTaxaMaker</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fish_SAmerica</span><span class="op">)</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Anostomidae</span> 
<span class="va">Characiformes</span>
<span class="va">Anostomidae</span> 
<span class="va">Characiformes</span>
<span class="va">Anostomidae</span> 
<span class="va">Characiformes</span>
<span class="va">Serrasalmidae</span>
<span class="va">Characiformes</span>
<span class="va">Auchenipteridae</span>
<span class="va">Siluriformes</span>
<span class="va">Auchenipteridae</span>
<span class="va">Siluriformes</span>
<span class="va">Auchenipteridae</span>
<span class="va">Siluriformes</span></code></pre></div>
<p>With taxon_data we can run <code>FishPhyloMaker</code> to obtain the phylogeny and the data frame with all the insertions made by each species</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>phylo_fish_SAmerica &lt;-<span class="st"> </span><span class="kw">FishPhyloMaker</span>(<span class="dt">data =</span> taxon_data, <span class="dt">return.insertions =</span> T)</span>
<span id="cb3-2"><a href="#cb3-2"></a>Serrasalmidae</span>
<span id="cb3-3"><a href="#cb3-3"></a>Acanthicus</span>
<span id="cb3-4"><a href="#cb3-4"></a>Schizodon</span>
<span id="cb3-5"><a href="#cb3-5"></a>Liosomadoras</span>
<span id="cb3-6"><a href="#cb3-6"></a>Hemiancistrus</span>
<span id="cb3-7"><a href="#cb3-7"></a>Ctenolucius</span>
<span id="cb3-8"><a href="#cb3-8"></a>Roeboexodon Exodon</span>
<span id="cb3-9"><a href="#cb3-9"></a>Leporinus</span>
<span id="cb3-10"><a href="#cb3-10"></a>Gymnotus</span>
<span id="cb3-11"><a href="#cb3-11"></a>Loricariichthys</span>
<span id="cb3-12"><a href="#cb3-12"></a>Anostomus</span>
<span id="cb3-13"><a href="#cb3-13"></a>Furcodontichthys</span>
<span id="cb3-14"><a href="#cb3-14"></a>Lasiancistrus</span>
<span id="cb3-15"><a href="#cb3-15"></a>Leporinus</span>
<span id="cb3-16"><a href="#cb3-16"></a>Schizodon Hypomasticus</span>
<span id="cb3-17"><a href="#cb3-17"></a>Batrochoglanis</span>
<span id="cb3-18"><a href="#cb3-18"></a>Pseudolithoxus</span>
<span id="cb3-19"><a href="#cb3-19"></a>Leporinus</span>
<span id="cb3-20"><a href="#cb3-20"></a>Anodus</span>
<span id="cb3-21"><a href="#cb3-21"></a>Paralonchurus</span>
<span id="cb3-22"><a href="#cb3-22"></a>Pachypops</span>
<span id="cb3-23"><a href="#cb3-23"></a>Vandellia Paravandellia</span>
<span id="cb3-24"><a href="#cb3-24"></a>Pachyurus</span>
<span id="cb3-25"><a href="#cb3-25"></a>Anostomus</span>
<span id="cb3-26"><a href="#cb3-26"></a>Sternarchorhamphus</span>
<span id="cb3-27"><a href="#cb3-27"></a>Vandellia</span>
<span id="cb3-28"><a href="#cb3-28"></a>Odontognathus</span>
<span id="cb3-29"><a href="#cb3-29"></a>Exallodontus</span>
<span id="cb3-30"><a href="#cb3-30"></a>Myleus</span>
<span id="cb3-31"><a href="#cb3-31"></a>Gnathodolus</span>
<span id="cb3-32"><a href="#cb3-32"></a>Trachelyopterus</span>
<span id="cb3-33"><a href="#cb3-33"></a>Hemiodontichthys</span>
<span id="cb3-34"><a href="#cb3-34"></a>Rhinelepis</span>
<span id="cb3-35"><a href="#cb3-35"></a>Pseudohemiodon</span>
<span id="cb3-36"><a href="#cb3-36"></a>Schizodon</span>
<span id="cb3-37"><a href="#cb3-37"></a>Gnathodolus</span>
<span id="cb3-38"><a href="#cb3-38"></a>Panaque Panaqolus</span>
<span id="cb3-39"><a href="#cb3-39"></a>Pseudacanthicus Leporacanthicus</span>
<span id="cb3-40"><a href="#cb3-40"></a>Hypopomidae</span>
<span id="cb3-41"><a href="#cb3-41"></a>Sternarchogiton</span>
<span id="cb3-42"><a href="#cb3-42"></a>Platyurosternarchus</span>
<span id="cb3-43"><a href="#cb3-43"></a>Gymnocorymbus</span>
<span id="cb3-44"><a href="#cb3-44"></a>Schizodon</span>
<span id="cb3-45"><a href="#cb3-45"></a>Synbranchidae</span>
<span id="cb3-46"><a href="#cb3-46"></a>Ageneiosus</span>
<span id="cb3-47"><a href="#cb3-47"></a>Asterophysus</span>
<span id="cb3-48"><a href="#cb3-48"></a>Trachelyopterus</span>
<span id="cb3-49"><a href="#cb3-49"></a>Ageneiosus</span></code></pre></div>
<p>The data frame can be extracted and the categories of insertion can be plotted in the phylogenetic tree by using the information on <code>phylo_fish_SAmerica$Insertions</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools">phytools</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotTree.html">plotTree</a></span><span class="op">(</span><span class="va">phylo_fish_SAmerica</span><span class="op">$</span><span class="va">Phylogeny</span>, fsize <span class="op">=</span> <span class="fl">0.1</span>, ftype <span class="op">=</span> <span class="st">"i"</span>,
         type <span class="op">=</span> <span class="st">"fan"</span>, lwd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>

<span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">phylo_fish_SAmerica</span><span class="op">$</span><span class="va">Phylogeny</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/makeNodeLabel.html">makeNodeLabel</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>

<span class="va">phylo</span> <span class="op">&lt;-</span> <span class="va">tree</span>

<span class="va">rm.famNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">taxon_data</span><span class="op">$</span><span class="va">f</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># monotipic families</span>
<span class="va">names.fam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">taxon_data</span><span class="op">$</span><span class="va">f</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">rm.famNames</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">names.fam</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">#i=3</span>
  <span class="va">set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">taxon_data</span>, <span class="va">f</span> <span class="op">==</span> <span class="va">names.fam</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/makeNodeLabel.html">makeNodeLabel</a></span><span class="op">(</span><span class="va">phylo</span>, <span class="st">"u"</span>, nodeList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Fam_name <span class="op">=</span> <span class="va">set</span><span class="op">$</span><span class="va">s</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">phylo</span><span class="op">$</span><span class="va">node.label</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">$</span><span class="va">node.label</span> <span class="op">==</span> 
                           <span class="st">"Fam_name"</span><span class="op">)</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set</span><span class="op">$</span><span class="va">f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">pos.node</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">names.fam</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">$</span><span class="va">node.label</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="va">df.phylo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Fam.names <span class="op">=</span> <span class="va">names.fam</span><span class="op">[</span><span class="op">-</span><span class="fl">33</span><span class="op">]</span>,
                       node.number <span class="op">=</span> <span class="va">pos.node</span><span class="op">[</span><span class="op">-</span><span class="fl">33</span><span class="op">]</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjmgarnier/viridis">viridis</a></span><span class="op">)</span>
<span class="va">p.base</span> <span class="op">&lt;-</span> <span class="fu">ggtree</span><span class="op">(</span><span class="va">phylo</span>, layout <span class="op">=</span> <span class="st">"circular"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># geom_tiplab2(size = 0.4) +</span>
  <span class="fu">geom_hilight</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df.phylo</span>, <span class="fu">aes</span><span class="op">(</span>node <span class="op">=</span> <span class="va">node.number</span>, fill <span class="op">=</span> <span class="va">Fam.names</span><span class="op">)</span>, 
               alpha <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
  </code></pre></div>
<p>In Figure 1 we can see all the insertions made in the insertion process.</p>
<div class="figure">
<img src="../vignettes/phylo_SAmerica.png" alt=""><p class="caption">Fig. 1 - Phylogenetic tree showing at which level each species was inserted in the mega-tree.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gabriel Nakamura, Aline Richter, Bruno Soares.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
