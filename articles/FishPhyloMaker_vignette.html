<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using FishPhyloMaker to build phylogenies for finned-ray fishes • FishPhyloMaker</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using FishPhyloMaker to build phylogenies for finned-ray fishes">
<meta property="og:description" content="FishPhyloMaker">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FishPhyloMaker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/FishPhyloMaker_vignette.html">Using FishPhyloMaker to build phylogenies for finned-ray fishes</a>
    </li>
    <li>
      <a href="../articles/mappingInsertions_vignette.html">How to map species insertions in phylogenetic tree?</a>
    </li>
    <li>
      <a href="../articles/whichFishAdd_vignette.html">How to know which species must be added to phylogeny?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="FishPhyloMaker_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using FishPhyloMaker to build phylogenies for finned-ray fishes</h1>
            
            <h4 class="date">2021-09-07</h4>
      
      
      <div class="hidden name"><code>FishPhyloMaker_vignette.Rmd</code></div>

    </div>

    
    
<p>In this article we will show how to obtain a phylogeny for a pool of species using FishPhyloMaker package. First of all, we need to install and read <code>{FishPhyloMaker}</code> package, that can be made using the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"GabrielNakamura/FishPhyloMaker"</span>, ref <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></code></pre></div>
<p>We will use a data base that contain stream fish species from Paraná and Paraguai basins. These comprises two of the main basins in Neotropical region. This data are embedded in the package and can be easily accessed by typing:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FishPhyloMaker</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">neotropical_comm</span><span class="op">)</span>
<span class="va">data_comm</span> <span class="op">&lt;-</span> <span class="va">neotropical_comm</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="co"># removing Latitude and Longitude</span></code></pre></div>
<p><code>neotropical_comm</code> correspond to a data frame containing the abundance of 59 fish species collected in 20 headwater streams, being 10 in Paraná and 10 in Paraguay Basin. To obtain a phylogenetic tree for these species we first need to format these data accordingly to enter in <code>FishPhyloMaker</code> function, that correspond to a data frame with three column containing the taxonomic information of each one of the 59 species. To prepare this data we will use the function <code>FishTaxaMaker</code> that finds for each species name present in the data_comm and checks if these names are found in <a href="%22https://www.fishbase.org%22">Fishbase</a>. Note that not all species was found in Fishbase data, so, the user must type manually, through an interactive process, the name of the Family and the Order of these species that was not found. A message will appear in the command prompt indicating when to type the names. The names must be typed sequentially, as in the following code.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">taxon_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FishTaxaMaker.html">FishTaxaMaker</a></span><span class="op">(</span><span class="va">data_comm</span>, allow.manual.insert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">Characidae</span>
<span class="va">Characiformes</span>
<span class="va">Characidae</span>
<span class="va">Characiformes</span>
<span class="va">Characidae</span>
<span class="va">Characiformes</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Characidae</span>
<span class="va">Characiformes</span>
<span class="va">Cichlidae</span>
<span class="va">Cichliformes</span>
<span class="va">Crenuchidae</span>
<span class="va">Characiformes</span>
<span class="va">Gymnotidae</span>
<span class="va">Gymnotiformes</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Heptapteridae</span>
<span class="va">Siluriformes</span>
<span class="va">Characidae</span>
<span class="va">Characiformes</span>
<span class="va">Loricariidae</span>
<span class="va">Siluriformes</span>
<span class="va">Characidae</span>
<span class="va">Characiformes</span></code></pre></div>
<p>This function will return a data frame with three columns and the same number of species present in data_comm, and now taxon_data can be used in <code>FishPhyloMaker</code> function to generate the phylogenetic tree for these species. In this example we will set the argument return.insertions = TRUE, since we want to know at which level of hierarchical taxonomy each species was inserted in the process, the levels are explained in the <a href="https://gabrielnakamura.github.io/FishPhyloMaker/index.html">introductory article</a>. Like <code>FishTaxaMaker</code> function, <code>FishPhyloMaker</code> also have a interactive process of insertion in which the user must inform at which position species must be inserted in the mega-tree. There are three options:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Insert the species near to a specific genus/family</strong>: To insert the species near to a specific genus/family, the user must type the name of the genus (or family) at which the species must be inserted;</p></li>
<li><p><strong>Insert the species between two genus/families</strong>: To insert the species between two different genus/families, the user must type the names of the two genus/families separated by a blank space;</p></li>
<li><p><strong>Insert at the root of the family/order</strong>: To insert the species at the node that corresponds to the family (or order), the user must type the name of the family.</p></li>
</ol>
<p>For each species a list of names containing Genus names or Family names will appear at command prompt, and the user must decide among one of the previous option.</p>
<p><em>NOTE</em> - The function can take several minutes to run depending on the number of species that must be inserted.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylo_fish_streams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FishPhyloMaker.html">FishPhyloMaker</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taxon_data</span>, 
                                     return.insertions <span class="op">=</span> <span class="cn">TRUE</span>,
                                     insert.base.node <span class="op">=</span> <span class="cn">TRUE</span>, 
                                     progress.bar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>In this example I choose to insert all the species that did not presented congeneric relatives in the base of its family.</p>
<p>The result of <code>FishPhyloMaker</code> is a list containing two objects, a phylogenetic tree and a data frame indicating at which level each species was inserted in the phylogeny. We can use the result contained in phylo_fish_streams to plot the tree. We can use the following code to highlight the families in the tree.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggtree</span><span class="op">)</span>
<span class="va">tree.PR</span><span class="op">&lt;-</span> <span class="va">phylo_fish_streams</span><span class="op">$</span><span class="va">Phylogeny</span>

<span class="va">tree.PR</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/makeNodeLabel.html">makeNodeLabel</a></span><span class="op">(</span><span class="va">tree.PR</span><span class="op">)</span>
<span class="va">phylo</span> <span class="op">&lt;-</span> <span class="va">tree.PR</span>

<span class="va">rm.famNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">taxon_dataPR</span><span class="op">$</span><span class="va">f</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># monotipic families</span>
<span class="va">names.fam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">taxon_dataPR</span><span class="op">$</span><span class="va">f</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">rm.famNames</span><span class="op">)</span><span class="op">)</span> <span class="co"># removing monotipic families from the names </span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">names.fam</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">taxon_dataPR</span>, <span class="va">f</span> <span class="op">==</span> <span class="va">names.fam</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/makeNodeLabel.html">makeNodeLabel</a></span><span class="op">(</span><span class="va">phylo</span>, <span class="st">"u"</span>, nodeList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Fam_name <span class="op">=</span> <span class="va">set</span><span class="op">$</span><span class="va">s</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">phylo</span><span class="op">$</span><span class="va">node.label</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">$</span><span class="va">node.label</span> <span class="op">==</span> 
                           <span class="st">"Fam_name"</span><span class="op">)</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">set</span><span class="op">$</span><span class="va">f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">pos.node</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">names.fam</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">$</span><span class="va">node.label</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="va">df.phylo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Fam.names <span class="op">=</span> <span class="va">names.fam</span>,
                       node.number <span class="op">=</span> <span class="va">pos.node</span><span class="op">)</span>

<span class="va">plot.base</span> <span class="op">&lt;-</span> <span class="fu">ggtree</span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_tree2</span><span class="op">(</span><span class="op">)</span>
<span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu">revts</span><span class="op">(</span><span class="va">plot.base</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_continuous</span><span class="op">(</span>labels<span class="op">=</span><span class="va">abs</span><span class="op">)</span>


<span class="va">PR.PG</span> <span class="op">&lt;-</span> <span class="va">plot1</span> <span class="op">+</span> <span class="fu">geom_hilight</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df.phylo</span>, <span class="fu">aes</span><span class="op">(</span>node <span class="op">=</span> <span class="va">node.number</span>, fill <span class="op">=</span> <span class="va">Fam.names</span><span class="op">)</span>, 
                      alpha <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis</span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">T</span>, name <span class="op">=</span> <span class="st">"Family names"</span><span class="op">)</span></code></pre></div>
<p>With this code we will obtain a phylogenetic tree like that in Figure 1. The species that are not shaded with colors corresponds to monotipic families.</p>
<div class="figure">
<img src="../vignettes/Phylo_Parana-Paraguai.png" alt=""><p class="caption">Fig. 1 - Phylogenetic tree containing 59 species of stream fishes in the Paraná and Paraguay Basins (Brazil).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gabriel Nakamura, Aline Richter, Bruno Soares.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
